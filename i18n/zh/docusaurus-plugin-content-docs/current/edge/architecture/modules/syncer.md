---
id: syncer
title: 同步模块
description: 对 Polygon Edge 的同步模块的解释。
keywords:
  - docs
  - polygon
  - edge
  - architecture
  - module
  - synchronization
---

## 概述 {#overview}

该模块包含同步协议的逻辑。用于在运行网络时同步新的 NODE，或为不参加共识的 NODE（非验证者）验证/输入新的区块。

Polygon Edge 使用 **libp2p** 作为网络层，在上方运行 **gRPC**。

Polygon Edge 中基本上有 2 个同步类型：
* 批量同步 - 一次性同步大量区块
* 观看同步 - 以每个区块为基础同步

### 批量同步 {#bulk-sync}

批量同步的步骤非常直接，可以适应大量同步的目标 - 尽可能多且尽可能快地从其他对等体同步区块。

这是批量同步过程的流程：

1. ** 决定是否该节点需要批量同步 ** - 在这一步骤中，NODE 查看对等体地图，观察是否有人持有比本地 NODE 更多的区块数量
2. ** 查看最佳对等体（使用同步对等体地图） ** - 在这一步中，NODE 找到最佳对等体，其标准是基于上述例子中提及的范围。
3. ** 打开大量同步流 ** - 在该步骤中，NODE 向最佳对等体开放 gRPC 流，从而从通用的区块数量中大量同步区块
4. ** 最佳对等体在完成大量发送时关闭流 ** - 在该步骤中，最佳对等体的 NODE 在发送所有其持有的区块后就立即关闭流。
5. ** 完成大量同步时，查看 NODE 是否是验证者 ** - 在这一步骤中，最佳对等体关闭流， NODE 需要在大量同步后查看其是否为验证者。
  * 如果它们是，则跳出同步状态，开始参与共识。
  * 如果它们不是，就继续 ** 观看同步 **

### 观看同步 {#watch-sync}

:::info

观看同步的步骤只有在 NODE 不是验证者时才会执行，但是网络中常规的非验证者 NODE 仅侦听即将出现的区块。
:::

观看同步的行为非常直接，该 NODE 已经和网络其余部分同步，仅需要分辨正在进入的新区块。

这是观看同步流程的过程：

1. ** 当同伴的状态是更新时，则添加新的区块 ** - 在该步骤中， NODE 侦听新区块事件，出现新区块时，会运行 gRPC 功能调用，获取区块并更新本地状态。
2. ** 同步最近区块后查看 NODE 是否是验证者 **
   * 如果是，就跳出同步状态
   * 如果不是，就继续侦听新的区块事件

## 性能报告 {#perfomance-report}

:::info

性能在本地机器上同步**一百万区块**进行测量
:::

| 名称 | 结果 |
|----------------------|----------------|
| 同步 1M 区块 | ~ 25 分钟 |
| 转移 1M 区块 | ~ 1 分钟 |
| GRPC 调用的数量 | 2 |
| 测试覆盖 | ~ 93% |